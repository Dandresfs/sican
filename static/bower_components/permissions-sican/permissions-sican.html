<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../paper-item/paper-icon-item.html">
<link rel="import" href="../paper-item/paper-item-body.html">
<link rel="import" href="../image-mask/image-mask.html">
<link rel="import" href="../iron-icons/av-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">

<dom-module id="permissions-sican">

  <style type="text/css">
    .paper-item-link {
        color: inherit;
        text-decoration: none;
    }

    .permission:hover {
        background: #F05623;
        color: white;
    }

    paper-icon-item{
        background: #F05623;
        color: white;
    }

    iron-collapse{
        background: #eee;
        padding: 20px;
    }

    .link-collapse:hover{
        background: #76b82a;
        color: white;
    }

    .list-group{
        margin: 0;
    }

    .permission_class{
        margin-bottom: 10px;
    }

  </style>

  <template>
    <iron-ajax auto url="{{ url }}" handle-as="json" last-response="{{ permission }}"></iron-ajax>
    <div role="listbox">
        <template is="dom-repeat" items="[[permission]]">
            <div class="permission_class">
                <a class="paper-item-link" href="#">
                    <paper-icon-item class="permission" on-tap="expand" id="[[item.id]]">
                        <paper-item-body>[[item.name]]</paper-item-body>
                        <iron-icon icon="[[item.icon]]" item-icon></iron-icon>
                        <iron-icon icon="arrow-drop-down" id="icon_arrow_[[item.id]]"></iron-icon>
                    </paper-icon-item>
                </a>
                <iron-collapse id="collapse_[[item.id]]">
                    <div class="list-group">
                        <template is="dom-repeat" items="[[item.links]]" as="links">
                            <a href="[[links.link]]" class="list-group-item link-collapse">
                                [[links.name]]
                            </a>
                        </template>
                    </div>
                </iron-collapse>
            </div>
        </template>
    </div>
  </template>

</dom-module>

<script>

  Polymer({

    is: 'permissions-sican',

    properties: {

      url: {
        type: String,
        value: ""
      },

    },

    expand: function(e){
        for(i=0;i< e.path.length;i++){
            if(e.path[i].nodeName == 'PAPER-ICON-ITEM'){
                var id_paper_item_icon = e.path[i].id;
                break;
            }
        }
        $('#collapse_'+id_paper_item_icon)[0].toggle();

        if($('#collapse_'+id_paper_item_icon)[0].opened == false){
            $('#icon_arrow_'+id_paper_item_icon)[0].icon = "arrow-drop-down";
        }
        else{
            $('#icon_arrow_'+id_paper_item_icon)[0].icon = "arrow-drop-up";
        }
    }

  });


</script>